# September 8th, 2022 - Users not able to see or chat with each other 

|                          |               |
| -----------------------: | :------------ |
| **Reported on Discord**  | 2022-09-08    |
|           **Mitigation** | 2022-09-08    |
|   **Solution Completed** | 2022-09-08    |
| **Severity**             | SEV-1         |

## What happened?

Users reported problems to see each other in the same realm and same scene, this also impacted on the Global/Nearby chat. In the Genesis plaza, the crowd tower with hot-scenes was not being populated with places and users. Go to realm command didn't work, and users count per realm showed different numbers in all servers. 

## Why did it happen?

The P2P connections are in charge of connecting users with each other. These connections between users generate meshes that determine who you can see and talk to. Due to a wrong type received when generating the link, some of the connections were not being established, having repercussion in all mentioned functionalities. On the other hand, Catalyst nodes stopped supporting `~/lambdas/explore/hot-realms/` endpoint with a slash `/` at the end, and this endpoint was being called from some scenes.   

## Issue Timeline

- After the latest Catalyst update it was reported that people using Firefox were not being able to see anyone around them in the world. Platform users on Firefox are less than 3% but all of them were affected by this. 
- A [patch](https://github.com/decentraland/comms3-transports/commit/622c7bf6fded83a746a309f33007d520a5c79b89) to fix the P2P communications on Firefox was pushed
- Many users started to report different problems: not able to see other players, different realms count, change realm command not working, scenes were not able to validate players positions, the crowd tower at the Genesis plaza was not showing any scene. The issue was promptly escalated to a SEV-1. 
- Comms message metric started to drop 
- Joining on an empty scene with a couple of avatars it was noticed a pattern: arriving users were able to see the ones that were there before but the other ones were not able to see the new ones. Debugging the P2P logic, a type miss match was noticed. 
- On the other hand by looking that the Genesis Plaza scene code, responsible for populating the crowd tower, it was noticed that the call to hot-scenes had a slash at the end which the catalyst API had stopped supporting ([code](https://github.com/decentraland-scenes/Genesis-Plaza/blob/acaaf9821c0968b2171775bb1deb3bed5924e9e7/src/lobby/checkApi.ts#L100))
- Two patches were created, one for [Kernel](https://github.com/decentraland/comms3-transports/commit/b37726db83d615ec8ba47e6b47c6c27d37e59f13) and one for the [Catalyst](https://github.com/decentraland/catalyst-owner/commit/eaa6bce95cac03db92ee089b161234e101ddbd36)   
- As scenes consumed some date from the Load Balancer (peer.decentraland.org) all nodes had to be updated in order to see the results. The patch was rollout to the network
- After the update was done, users confirmed that things started to improved, realms count were correct, change realm worked, people started to see each other and be able to chat, the crowd tower had the hot-scenes list populated. 


## Impact

During the hours of the  incident time, many users were no able to see each other, chat, change realm or go to places. All users noticed a general platform instability.   


## Solution

- Type correction added in the client when generating the mesh ([commit](https://github.com/decentraland/comms3-transports/commit/b37726db83d615ec8ba47e6b47c6c27d37e59f13))
- Comms [Improvements]((https://github.com/decentraland/kernel/commit/17050b71edc8d234e090893558ae9e6acad179ca)) added to dispose the connections 
- Make `/hot-realms/` work as `/hot-realms` ([commit](https://github.com/decentraland/catalyst-owner/commit/eaa6bce95cac03db92ee089b161234e101ddbd36))
  
